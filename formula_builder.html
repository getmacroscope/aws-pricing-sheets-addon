<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>React in HTML</title>
  <script src="https://unpkg.com/react@17.0.2/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>

  <style>
    .App {
      width:285px;
      font-family: arial, sans-serif;
      padding-bottom: 80px; /* footer is overlay and fixed */
    }

    .logolinks {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
    }


  .logolinks {
    display: flex;
    justify-content: space-around;
  }
  
  .logolinks a {
    font-size: 40px;
    color: black;
  }
  
  .logolinks a > svg {
    transition: 0.1s;
  }
  
  .logolinks a > svg:hover {
    transform: scale(1.3);
  }
  
  .sidebar.bottom {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 285px;
    height: 50px;
    text-align: right;
    padding: 15px !important;
    background: white;
    margin: 0;
  }
  
  .icon {
    width: 40px;
    height: 40px;
  }

    table {
      border-collapse: collapse;
      width: 100%;
      font-family: Arial, sans-serif;
    }
    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    td:first-child {
      width: 300px;
    }
    td:nth-child(2) {
      width: 50px;
    }


    select {
      max-width: 150px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      font-size: 16px;
      font-family: Arial, sans-serif;
      color: #555;
      background-color: #fff;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
    }
    select:focus {
      outline: none;
      border-color: #4CAF50;
    }
    option {
      max-width: 150px;
      font-size: 16px;
      font-family: Arial, sans-serif;
      color: #555;
      background-color: #fff;
    }

    input[type="number"] {
      max-width: 100px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      font-size: 16px;
      font-family: Arial, sans-serif;
      color: #555;
      background-color: #fff;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: #4CAF50;
    }

    span.text {
      display: inline-block;
      max-width: 100px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      font-size: 16px;
      font-family: Arial, sans-serif;
      color: #555;
      background-color: #fff;
    }


    textarea {
      box-sizing: border-box;
      width: 100%;
      height: auto;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      font-size: 16px;
      font-family: Arial, sans-serif;
      color: #555;
      background-color: #fff;
      resize: none;
    }
    textarea:focus {
      outline: none;
      border-color: #4CAF50;
    }

    button {
      padding: 8px;
      font-size: 16px;
      font-family: Arial, sans-serif;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button.halfWidth {
      display: inline-block;
      width: 50%;
    }
    button.fullWidth {
      display: block;
      width: 100%;
    }

    button.purple {
      color: #ffffff;
      background-color: #372753;
    }
    button.border {
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button.active {
      background-color: #372753;
      color: #e7def4;
    }

    button:focus {
      outline: none;
    }
    button:hover {
      background-color: #5c418a;
      color: #e7def4;
    }

    .tabs {
      margin-bottom: 4px;
    }

    .header {
      font-family: Arial, sans-serif;
      font-size: 16px;
      font-weight: bold;
      color: #555;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      margin-bottom: 4px;
      text-align: center;
    }

    #tooltip {
      position: absolute;
      display: none;
      background: cornsilk;
      border: 1px solid black;
      font-size: 13px;
      /* border-radius: 5px; */
      padding: 2px;
      color: rgb(49, 49, 49);
      z-index:10;
    }

    td:nth-child(1) {
      width: 100px;
    }

    td:nth-child(2) {
      width: 300px;
    }

    .dropdown-check-list {
      display: inline-block;
    }

    .dropdown-check-list .anchor {
      position: relative;
      cursor: pointer;
      max-width: 170px;
      display: inline-block;
      padding: 5px 50px 5px 10px;
      border: 1px solid #ccc;
      /* max-width: 120px; */
      /* Allows the text to break onto the next line */
      white-space: normal;  
      /* Break the word if it's too long */
      overflow-wrap: break-word;  
      /* Padding to ensure the text doesn't overlap with the dropdown symbol */
      padding-right: 30px;  
      /* To include padding and border in element's total width and height */
      box-sizing: border-box;  
    }

    .dropdown-check-list .anchor:after {
      position: absolute;
      content: "";
      border-left: 2px solid #666666;
      border-top: 2px solid #666666;
      padding: 5px;
      /* Adjust this if needed to match the new padding on the right of .anchor */
      right: 10px;  
      top: 20%;
      -moz-transform: rotate(-135deg);
      -ms-transform: rotate(-135deg);
      -o-transform: rotate(-135deg);
      -webkit-transform: rotate(-135deg);
      transform: rotate(-135deg);
    }

    .dropdown-check-list .anchor:active:after {
      right: 8px;
      top: 21%;
    }

    .dropdown-check-list ul.items {
      padding: 5px;
      margin: 0;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 220px; /* Adjust this value according to your needs */
      overflow: auto;
    }

    .dropdown-check-list ul.items label {
      cursor: pointer;
    }

    .dropdown-check-list ul.items li {
      list-style: none;
    }

    .dropdown-check-list.visible .anchor {
      color: #0094ff;
    }

    span.anchor {
      display: inline-block;
      min-height: 1.9em;
    }

    .dropdown-check-list.visible .items {
      display: block;
    }

    .dropdown-check-list .search {
      width: 150px;
      border: 1px solid #ccc;
      padding: 10px;
    }

  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    function App() {
      const textareaRef = React.useRef(null);
      const [formula, setFormula] = React.useState('');
      const [args, setArgs] = React.useState([]);
      const [service, setService] = React.useState('ec2');
      const tooltipRef = React.useRef(null);
      const [comparisonEnabled, setComparisonEnabled] = React.useState(false);

      React.useEffect(() => {
        const textarea = textareaRef.current;
        textarea.style.height = textarea.scrollHeight + 'px';
      }, [formula]);

      function insertFormula() {
        console.log('formula ' + formula);
        console.log('args ' + args.join(', '));
        const argumentsPerComponent = {
          ec2: ["purchaseType", "instanceType", "region", "platform", "offeringClass", "purchaseTerm", "paymentOption", "sqlLicense"],
          ebs: ["volumeType", "storageType", "volumeSize", "region"],
          rds: ["dbEngine", "instanceType", "region", "purchaseType", "purchaseTerm", "paymentOption"],
          rdsStorage: ["storageType", "storageSize", "region"]
        }
        const argumentNames = argumentsPerComponent[service]
        google.script.run.insertFormula(formula, args, argumentNames);
      }
    
      function renderServiceComponent(service, setFormula, setArgs, comparisonEnabled) {
        const serviceComponents = {
          ec2: EC2,
          ebs: EBS,
          rds: RDS,
          rdsStorage: RDSStorage
        };
        const ServiceComponent = serviceComponents[service];
        return ServiceComponent ? <ServiceComponent setFormula={setFormula} setArgs={setArgs} comparisonEnabled={comparisonEnabled}/> : null;
      }
      
      function showTooltip(evt, text) {
        const tooltip = tooltipRef.current;
        tooltip.innerHTML = text;
        tooltip.style.display = "block";
        tooltip.style.left = evt.pageX + 10 + 'px';
        tooltip.style.top = evt.pageY - 30 + 'px';
      }

      function hideTooltip() {
        const tooltip = tooltipRef.current;
        tooltip.style.display = "none";
      }

      function displayFormula(text) {
        return text.replace(/"[^"]+?\/[^"]+?"/g, '"compare"');
      }

      function showFormulaTab() {
        setComparisonEnabled(false);
      }

      function showCompareFormulaTab() {
        setComparisonEnabled(true);
      }


        return (
          <div className="App">
            <div ref={tooltipRef} id="tooltip" style={{ display: "none" }}></div>
            <div className="tabs">
              <button onClick={showFormulaTab} className={"halfWidth tab" + (!comparisonEnabled && " active")}>Formula</button>
              <button onClick={showCompareFormulaTab} className={"halfWidth tab" + (comparisonEnabled && " active")}>Compare</button>
            </div>
            <div className="header">
              <table>
                <tr>
                  <td>Select Service</td>
                  <td>
                    <select onChange={e => setService(e.target.value)}>
                      <option value="ec2">EC2</option>
                      <option value="ebs">EBS</option>
                      <option value="rds">RDS</option>
                      <option value="rdsStorage">RDS storage</option>
                    </select>
                </td>
                </tr>
              </table>
            </div>
            <textarea ref={textareaRef} value={displayFormula(formula)} onChange={event => setFormula(event.target.value)}></textarea>
            <button className="fullWidth border purple" onClick={insertFormula}>
              {comparisonEnabled && args.join("").indexOf("/") > -1 ? `Insert formula's in sheet "compare"` : 'Insert Formula in active cell'}
            </button>
            {renderServiceComponent(service, setFormula, setArgs, comparisonEnabled)}

            <div className="sidebar bottom">
              <span className="gray logolinks">
                <a href="https://www.getstrake.com" target="_blank" title="Strake">
                  <svg className="icon" onMouseMove={(evt) => showTooltip(evt, 'Strake')} onMouseOut={hideTooltip} width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="19.5" fill="#F8F9FB" stroke="#CDD3E5"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M15.8333 10L15.7931 10.0001H15.6667C15.6032 10.0001 15.5406 10.0037 15.479 10.0106C12.4223 10.1937 10 12.7306 10 15.8333C10 18.935 12.4208 21.4713 15.4761 21.6559C15.5386 21.663 15.6022 21.6667 15.6667 21.6667H24.1667C25.5474 21.6667 26.6667 22.7859 26.6667 24.1667C26.6667 25.5474 25.5474 26.6666 24.1667 26.6666V26.6667H11.6667C10.7462 26.6667 10 27.4129 10 28.3333C10 29.2538 10.7462 30 11.6667 30H24.3333C24.3978 30 24.4614 29.9963 24.5239 29.9892C27.5792 29.8046 30 27.2683 30 24.1667C30 21.0649 27.579 18.5285 24.5236 18.3441C24.4612 18.337 24.3977 18.3333 24.3333 18.3333H24.1667H15.8333V18.3333C14.4526 18.3333 13.3333 17.214 13.3333 15.8333C13.3333 14.4614 14.4385 13.3476 15.8071 13.3335H28.3333C29.2538 13.3335 30 12.5873 30 11.6668C30 10.7463 29.2538 10.0001 28.3333 10.0001H15.8333V10Z" fill="white"/>
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M15.8333 10L15.7931 10.0001H15.6667C15.6032 10.0001 15.5406 10.0037 15.479 10.0106C12.4223 10.1937 10 12.7306 10 15.8333C10 18.935 12.4208 21.4713 15.4761 21.6559C15.5386 21.663 15.6022 21.6667 15.6667 21.6667H24.1667C25.5474 21.6667 26.6667 22.7859 26.6667 24.1667C26.6667 25.5474 25.5474 26.6666 24.1667 26.6666V26.6667H11.6667C10.7462 26.6667 10 27.4129 10 28.3333C10 29.2538 10.7462 30 11.6667 30H24.3333C24.3978 30 24.4614 29.9963 24.5239 29.9892C27.5792 29.8046 30 27.2683 30 24.1667C30 21.0649 27.579 18.5285 24.5236 18.3441C24.4612 18.337 24.3977 18.3333 24.3333 18.3333H24.1667H15.8333V18.3333C14.4526 18.3333 13.3333 17.214 13.3333 15.8333C13.3333 14.4614 14.4385 13.3476 15.8071 13.3335H28.3333C29.2538 13.3335 30 12.5873 30 11.6668C30 10.7463 29.2538 10.0001 28.3333 10.0001H15.8333V10Z" fill="url(#paint0_linear_526_850)"/>
                    <defs>
                    <linearGradient id="paint0_linear_526_850" x1="20" y1="30.0444" x2="20" y2="10.0444" gradientUnits="userSpaceOnUse">
                    <stop stop-color="#144BB8"/>
                    <stop offset="0.9999" stop-color="#A83E79"/>
                    </linearGradient>
                    </defs>
                    </svg>
                    
                </a>
                <a href="https://github.com/getstrake" target="_blank">
                  <svg className="icon" onMouseMove={(evt) => showTooltip(evt, 'Github')} onMouseOut={hideTooltip} width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="19.5" fill="#F8F9FB" stroke="#CDD3E5"/>
                    <path d="M20 8C13.37 8 8 13.5058 8 20.3035C8 25.7478 11.435 30.3463 16.205 31.9765C16.805 32.0842 17.03 31.715 17.03 31.3921C17.03 31.0999 17.015 30.131 17.015 29.1005C14 29.6696 13.22 28.347 12.98 27.6549C12.845 27.3012 12.26 26.2092 11.75 25.917C11.33 25.6863 10.73 25.1173 11.735 25.1019C12.68 25.0865 13.355 25.9939 13.58 26.363C14.66 28.2239 16.385 27.701 17.075 27.3781C17.18 26.5783 17.495 26.04 17.84 25.7325C15.17 25.4249 12.38 24.3637 12.38 19.6576C12.38 18.3196 12.845 17.2123 13.61 16.351C13.49 16.0434 13.07 14.7823 13.73 13.0906C13.73 13.0906 14.735 12.7676 17.03 14.3517C17.99 14.0749 19.01 13.9365 20.03 13.9365C21.05 13.9365 22.07 14.0749 23.03 14.3517C25.325 12.7522 26.33 13.0906 26.33 13.0906C26.99 14.7823 26.57 16.0434 26.45 16.351C27.215 17.2123 27.68 18.3042 27.68 19.6576C27.68 24.3791 24.875 25.4249 22.205 25.7325C22.64 26.1169 23.015 26.8552 23.015 28.0086C23.015 29.6542 23 30.9768 23 31.3921C23 31.715 23.225 32.0995 23.825 31.9765C26.2073 31.1521 28.2775 29.5824 29.744 27.4884C31.2106 25.3944 31.9996 22.8815 32 20.3035C32 13.5058 26.63 8 20 8Z" fill="black"/>
                    </svg>
                </a>
                <a href="https://strake-community.slack.com/join/shared_invite/zt-1nisfazzn-uO5O_I28Z7N6sZ6iM2H1xA" target="_blank" title="Slack">
                  <svg onMouseMove={(evt) => showTooltip(evt, 'Slack')} onMouseOut={hideTooltip} width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="19.5" fill="#F8F9FB" stroke="#CDD3E5"/>
                    <g clip-path="url(#clip0_526_857)">
                    <path d="M16.835 13.043C15.446 13.043 14.312 11.909 14.312 10.5215C14.312 9.134 15.446 8 16.835 8C18.224 8 19.355 9.134 19.355 10.52V13.043H16.835ZM16.835 14.312C18.221 14.312 19.355 15.446 19.355 16.8335C19.355 18.221 18.221 19.355 16.835 19.355H10.52C9.1355 19.355 8 18.221 8 16.835C8 15.446 9.134 14.312 10.52 14.312H16.835Z" fill="#36C5F0"/>
                    <path d="M26.9585 16.835C26.9585 15.446 28.091 14.312 29.4785 14.312C30.866 14.312 32 15.446 32 16.8335C32 18.221 30.866 19.355 29.48 19.355H26.9585V16.835ZM25.6865 16.835C25.6865 18.221 24.554 19.355 23.1665 19.355C22.4985 19.3534 21.8583 19.0875 21.3858 18.6153C20.9133 18.143 20.647 17.503 20.645 16.835V10.52C20.645 9.1355 21.779 8 23.165 8C24.554 8 25.6865 9.134 25.6865 10.52V16.835Z" fill="#2EB67D"/>
                    <path d="M23.165 26.957C24.554 26.957 25.688 28.091 25.688 29.4785C25.688 30.866 24.554 32 23.165 32C21.776 32 20.6435 30.866 20.6435 29.48V26.957H23.165ZM23.165 25.6865C21.779 25.6865 20.645 24.554 20.645 23.1665C20.645 21.779 21.779 20.645 23.165 20.645H29.48C30.866 20.645 32 21.779 32 23.165C32 24.554 30.866 25.6865 29.48 25.6865H23.165Z" fill="#ECB22E"/>
                    <path d="M13.043 23.165C13.043 24.554 11.909 25.6865 10.5215 25.6865C9.134 25.6865 8 24.554 8 23.1665C8 21.779 9.134 20.645 10.52 20.645H13.043V23.165ZM14.312 23.165C14.312 21.779 15.446 20.645 16.8335 20.645C18.221 20.645 19.355 21.779 19.355 23.165V29.48C19.355 30.866 18.221 32 16.835 32C16.1667 31.9988 15.5262 31.733 15.0533 31.2608C14.5805 30.7885 14.314 30.1483 14.312 29.48V23.165Z" fill="#E01E5A"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_526_857">
                    <rect width="24" height="24" fill="white" transform="translate(8 8)"/>
                    </clipPath>
                    </defs>
                    </svg>
                </a>
              </span>
            </div>
          </div>
        )
    }
  
  function SelectInput({options, value, disabled, onChange}) {
    const displayValue = value.includes("/") ? "compare" : value;
    
    return (
        <select disabled={disabled} value={displayValue} onChange={onChange}>
            {options.map(x => <option value={x}>{x}</option>)}
        </select>
    );
  }

  function SelectInputWithMultipleOptions({ options, value, disabled, setter }) {
    const [isDropdownVisible, setDropdownVisible] = React.useState(false);
    const [searchTerm, setSearchTerm] = React.useState("");
    const dropdownRef = React.useRef(null);

    React.useEffect(() => {
      function handleClickOutside(event) {
        if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
          setDropdownVisible(false);
        }
      }

      document.addEventListener("mousedown", handleClickOutside);
      return () => document.removeEventListener("mousedown", handleClickOutside);
    }, []);

    React.useEffect(() => {
      if (isDropdownVisible) {
        const dropdownBottom = dropdownRef.current.getBoundingClientRect().bottom;
        const windowHeight = window.innerHeight;
        const footerHeight = 50;
        const dropdownMargin = 50;

        if (dropdownBottom > windowHeight - footerHeight - dropdownMargin) {
          window.scrollTo({
            top: dropdownMargin + footerHeight + window.pageYOffset + (dropdownBottom - windowHeight),
            behavior: "smooth"
          });
        }
      }
    }, [isDropdownVisible]);

    const toggleDropdown = () => {
      setDropdownVisible(!isDropdownVisible);
    };

    const handleCheckboxChange = (e, option) => {
      if(option === "unselect all") {
        setter("");
        return;
      }
      console.log({ e: e.target.checked, option });
      if(e.target.checked) {
        setter(value.split("/").filter(x=>x).concat(option).sort().join("/"));
      } else {
        setter(value.split("/").filter(x => x !== option).sort().join("/"));
      }
    };

    const displayValue = v => v.split("/").slice(0, 2).join("/") + (v.split("/").length > 2 ? "/" + '...' : '');

    const filteredOptions = options.filter(option => 
      option.toLowerCase().indexOf(searchTerm.toLowerCase()) === 0
    );

    const addExtraOptions = (options) => {
      if(options.length > 10) {
        return ["unselect all", ...filteredOptions];
      } else {
        return options;
      }
    }

    if(disabled) {
      return <SelectInput options={options} value={value} disabled={disabled} onChange={setter} />
    }

    return (
      <div className="dropdown-check-list" tabIndex="100" ref={dropdownRef}>
        <span className="anchor" onClick={toggleDropdown}>
          {displayValue(value)}
        </span>
        {isDropdownVisible && (
          <div>
            
            {options.length > 10 && <input
              type="text"
              className="search"
              placeholder="Search..."
              value={searchTerm}
              onChange={e => setSearchTerm(e.target.value)}
            />}
            <ul className="items">
            {addExtraOptions(options).map((option) => (
              <li key={option}>
                <label>
                  <input
                    type="checkbox"
                    onChange={(e) => handleCheckboxChange(e, option)}
                    checked={value.split("/").includes(option)}
                  />
                  {option}
                </label>
              </li>
            ))}
          </ul>
          </div>
        )}
      </div>
    );
  }

  const SelectInputWithCheckboxes = ({ comparisonEnabled, options, value, setter, disabled }) => {

    React.useEffect(() => {
      if(!comparisonEnabled) {
        // when you switch from comparison to non-comparison mode, remove the comparison part
        setter(value.split("/")[0]);
      }
    },[comparisonEnabled])

    if (comparisonEnabled) {
      return (
        <SelectInputWithMultipleOptions
          options={options}
          value={value}
          setter={setter}
          disabled={disabled}
        />
      );
    } else {
      return (
        <SelectInput
          options={options}
          value={value}
          onChange={e => setter(e.target.value)}
          disabled={disabled}
        />
      );
    }
  }

  function EC2({setFormula, setArgs, comparisonEnabled}) {
      const [purchaseType, setPurchaseType] = React.useState('ondemand');
      const [instanceType, setInstanceType] = React.useState('m5.xlarge');
      const [region, setRegion] = React.useState('us-east-1');
      const [platform, setPlatform] = React.useState('linux');
      const [offeringClass, setOfferingClass] = React.useState('standard');
      const [purchaseTerm, setPurchaseTerm] = React.useState('1yr');
      const [paymentOption, setPaymentOption] = React.useState('all_upfront');
      const [sqlLicense, setSQLLicense] = React.useState('std');
      const [baseFormula, setBaseFormula] = React.useState('EC2');

      const purchaseTypes = ["ondemand", "reserved"];

      const instanceTypes = ["a1.2xlarge","a1.4xlarge","a1.large","a1.medium","a1.xlarge","c1.medium","c1.xlarge","c3.2xlarge","c3.4xlarge","c3.8xlarge","c3.large","c3.xlarge","c4.2xlarge","c4.4xlarge","c4.8xlarge","c4.large","c4.xlarge","c5.12xlarge","c5.18xlarge","c5.24xlarge","c5.2xlarge","c5.4xlarge","c5.9xlarge","c5.large","c5.xlarge","c5a.12xlarge","c5a.16xlarge","c5a.24xlarge","c5a.2xlarge","c5a.4xlarge","c5a.8xlarge","c5a.large","c5a.xlarge","c5ad.12xlarge","c5ad.16xlarge","c5ad.24xlarge","c5ad.2xlarge","c5ad.4xlarge","c5ad.8xlarge","c5ad.large","c5ad.xlarge","c5d.12xlarge","c5d.18xlarge","c5d.24xlarge","c5d.2xlarge","c5d.4xlarge","c5d.9xlarge","c5d.large","c5d.xlarge","c5n.18xlarge","c5n.2xlarge","c5n.4xlarge","c5n.9xlarge","c5n.large","c5n.xlarge","c6a.12xlarge","c6a.16xlarge","c6a.24xlarge","c6a.2xlarge","c6a.32xlarge","c6a.48xlarge","c6a.4xlarge","c6a.8xlarge","c6a.large","c6a.xlarge","c6g.12xlarge","c6g.16xlarge","c6g.2xlarge","c6g.4xlarge","c6g.8xlarge","c6g.large","c6g.medium","c6g.xlarge","c6gd.12xlarge","c6gd.16xlarge","c6gd.2xlarge","c6gd.4xlarge","c6gd.8xlarge","c6gd.large","c6gd.medium","c6gd.xlarge","c6gn.12xlarge","c6gn.16xlarge","c6gn.2xlarge","c6gn.4xlarge","c6gn.8xlarge","c6gn.large","c6gn.medium","c6gn.xlarge","c6i.12xlarge","c6i.16xlarge","c6i.24xlarge","c6i.2xlarge","c6i.32xlarge","c6i.4xlarge","c6i.8xlarge","c6i.large","c6i.xlarge","c6id.12xlarge","c6id.16xlarge","c6id.24xlarge","c6id.2xlarge","c6id.32xlarge","c6id.4xlarge","c6id.8xlarge","c6id.large","c6id.xlarge","c6in.12xlarge","c6in.16xlarge","c6in.24xlarge","c6in.2xlarge","c6in.32xlarge","c6in.4xlarge","c6in.8xlarge","c6in.large","c6in.xlarge","c7g.12xlarge","c7g.16xlarge","c7g.2xlarge","c7g.4xlarge","c7g.8xlarge","c7g.large","c7g.medium","c7g.xlarge","cc2.8xlarge","cr1.8xlarge","d2.2xlarge","d2.4xlarge","d2.8xlarge","d2.xlarge","d3.2xlarge","d3.4xlarge","d3.8xlarge","d3.xlarge","d3en.12xlarge","d3en.2xlarge","d3en.4xlarge","d3en.6xlarge","d3en.8xlarge","d3en.xlarge","dl1.24xlarge","f1.16xlarge","f1.2xlarge","f1.4xlarge","g2.2xlarge","g2.8xlarge","g3.16xlarge","g3.4xlarge","g3.8xlarge","g3s.xlarge","g4ad.16xlarge","g4ad.2xlarge","g4ad.4xlarge","g4ad.8xlarge","g4ad.xlarge","g4dn.12xlarge","g4dn.16xlarge","g4dn.2xlarge","g4dn.4xlarge","g4dn.8xlarge","g4dn.xlarge","g5.12xlarge","g5.16xlarge","g5.24xlarge","g5.2xlarge","g5.48xlarge","g5.4xlarge","g5.8xlarge","g5.xlarge","g5g.16xlarge","g5g.2xlarge","g5g.4xlarge","g5g.8xlarge","g5g.xlarge","h1.16xlarge","h1.2xlarge","h1.4xlarge","h1.8xlarge","hpc6a.48xlarge","hpc6id.32xlarge","hs1.8xlarge","i2.2xlarge","i2.4xlarge","i2.8xlarge","i2.xlarge","i3.16xlarge","i3.2xlarge","i3.4xlarge","i3.8xlarge","i3.large","i3.xlarge","i3en.12xlarge","i3en.24xlarge","i3en.2xlarge","i3en.3xlarge","i3en.6xlarge","i3en.large","i3en.xlarge","i4i.16xlarge","i4i.2xlarge","i4i.32xlarge","i4i.4xlarge","i4i.8xlarge","i4i.large","i4i.xlarge","im4gn.16xlarge","im4gn.2xlarge","im4gn.4xlarge","im4gn.8xlarge","im4gn.large","im4gn.xlarge","inf1.24xlarge","inf1.2xlarge","inf1.6xlarge","inf1.xlarge","is4gen.2xlarge","is4gen.4xlarge","is4gen.8xlarge","is4gen.large","is4gen.medium","is4gen.xlarge","m1.large","m1.medium","m1.small","m1.xlarge","m2.2xlarge","m2.4xlarge","m2.xlarge","m3.2xlarge","m3.large","m3.medium","m3.xlarge","m4.10xlarge","m4.16xlarge","m4.2xlarge","m4.4xlarge","m4.large","m4.xlarge","m5.12xlarge","m5.16xlarge","m5.24xlarge","m5.2xlarge","m5.4xlarge","m5.8xlarge","m5.large","m5.xlarge","m5a.12xlarge","m5a.16xlarge","m5a.24xlarge","m5a.2xlarge","m5a.4xlarge","m5a.8xlarge","m5a.large","m5a.xlarge","m5ad.12xlarge","m5ad.16xlarge","m5ad.24xlarge","m5ad.2xlarge","m5ad.4xlarge","m5ad.8xlarge","m5ad.large","m5ad.xlarge","m5d.12xlarge","m5d.16xlarge","m5d.24xlarge","m5d.2xlarge","m5d.4xlarge","m5d.8xlarge","m5d.large","m5d.xlarge","m5dn.12xlarge","m5dn.16xlarge","m5dn.24xlarge","m5dn.2xlarge","m5dn.4xlarge","m5dn.8xlarge","m5dn.large","m5dn.xlarge","m5n.12xlarge","m5n.16xlarge","m5n.24xlarge","m5n.2xlarge","m5n.4xlarge","m5n.8xlarge","m5n.large","m5n.xlarge","m5zn.12xlarge","m5zn.2xlarge","m5zn.3xlarge","m5zn.6xlarge","m5zn.large","m5zn.xlarge","m6a.12xlarge","m6a.16xlarge","m6a.24xlarge","m6a.2xlarge","m6a.32xlarge","m6a.48xlarge","m6a.4xlarge","m6a.8xlarge","m6a.large","m6a.xlarge","m6g.12xlarge","m6g.16xlarge","m6g.2xlarge","m6g.4xlarge","m6g.8xlarge","m6g.large","m6g.medium","m6g.xlarge","m6gd.12xlarge","m6gd.16xlarge","m6gd.2xlarge","m6gd.4xlarge","m6gd.8xlarge","m6gd.large","m6gd.medium","m6gd.xlarge","m6i.12xlarge","m6i.16xlarge","m6i.24xlarge","m6i.2xlarge","m6i.32xlarge","m6i.4xlarge","m6i.8xlarge","m6i.large","m6i.xlarge","m6id.12xlarge","m6id.16xlarge","m6id.24xlarge","m6id.2xlarge","m6id.32xlarge","m6id.4xlarge","m6id.8xlarge","m6id.large","m6id.xlarge","m6idn.12xlarge","m6idn.16xlarge","m6idn.24xlarge","m6idn.2xlarge","m6idn.32xlarge","m6idn.4xlarge","m6idn.8xlarge","m6idn.large","m6idn.xlarge","m6in.12xlarge","m6in.16xlarge","m6in.24xlarge","m6in.2xlarge","m6in.32xlarge","m6in.4xlarge","m6in.8xlarge","m6in.large","m6in.xlarge","p2.16xlarge","p2.8xlarge","p2.xlarge","p3.16xlarge","p3.2xlarge","p3.8xlarge","p3dn.24xlarge","p4d.24xlarge","p4de.24xlarge","r3.2xlarge","r3.4xlarge","r3.8xlarge","r3.large","r3.xlarge","r4.16xlarge","r4.2xlarge","r4.4xlarge","r4.8xlarge","r4.large","r4.xlarge","r5.12xlarge","r5.16xlarge","r5.24xlarge","r5.2xlarge","r5.4xlarge","r5.8xlarge","r5.large","r5.xlarge","r5a.12xlarge","r5a.16xlarge","r5a.24xlarge","r5a.2xlarge","r5a.4xlarge","r5a.8xlarge","r5a.large","r5a.xlarge","r5ad.12xlarge","r5ad.16xlarge","r5ad.24xlarge","r5ad.2xlarge","r5ad.4xlarge","r5ad.8xlarge","r5ad.large","r5ad.xlarge","r5b.12xlarge","r5b.16xlarge","r5b.24xlarge","r5b.2xlarge","r5b.4xlarge","r5b.8xlarge","r5b.large","r5b.xlarge","r5d.12xlarge","r5d.16xlarge","r5d.24xlarge","r5d.2xlarge","r5d.4xlarge","r5d.8xlarge","r5d.large","r5d.xlarge","r5dn.12xlarge","r5dn.16xlarge","r5dn.24xlarge","r5dn.2xlarge","r5dn.4xlarge","r5dn.8xlarge","r5dn.large","r5dn.xlarge","r5n.12xlarge","r5n.16xlarge","r5n.24xlarge","r5n.2xlarge","r5n.4xlarge","r5n.8xlarge","r5n.large","r5n.xlarge","r6a.12xlarge","r6a.16xlarge","r6a.24xlarge","r6a.2xlarge","r6a.32xlarge","r6a.48xlarge","r6a.4xlarge","r6a.8xlarge","r6a.large","r6a.xlarge","r6g.12xlarge","r6g.16xlarge","r6g.2xlarge","r6g.4xlarge","r6g.8xlarge","r6g.large","r6g.medium","r6g.xlarge","r6gd.12xlarge","r6gd.16xlarge","r6gd.2xlarge","r6gd.4xlarge","r6gd.8xlarge","r6gd.large","r6gd.medium","r6gd.xlarge","r6i.12xlarge","r6i.16xlarge","r6i.24xlarge","r6i.2xlarge","r6i.32xlarge","r6i.4xlarge","r6i.8xlarge","r6i.large","r6i.xlarge","r6id.12xlarge","r6id.16xlarge","r6id.24xlarge","r6id.2xlarge","r6id.32xlarge","r6id.4xlarge","r6id.8xlarge","r6id.large","r6id.xlarge","r6idn.12xlarge","r6idn.16xlarge","r6idn.24xlarge","r6idn.2xlarge","r6idn.32xlarge","r6idn.4xlarge","r6idn.8xlarge","r6idn.large","r6idn.xlarge","r6in.12xlarge","r6in.16xlarge","r6in.24xlarge","r6in.2xlarge","r6in.32xlarge","r6in.4xlarge","r6in.8xlarge","r6in.large","r6in.xlarge","t1.micro","t2.2xlarge","t2.large","t2.medium","t2.micro","t2.nano","t2.small","t2.xlarge","t3.2xlarge","t3.large","t3.medium","t3.micro","t3.nano","t3.small","t3.xlarge","t3a.2xlarge","t3a.large","t3a.medium","t3a.micro","t3a.nano","t3a.small","t3a.xlarge","t4g.2xlarge","t4g.large","t4g.medium","t4g.micro","t4g.nano","t4g.small","t4g.xlarge","trn1.2xlarge","trn1.32xlarge","u-12tb1.112xlarge","u-18tb1.112xlarge","u-24tb1.112xlarge","u-3tb1.56xlarge","u-6tb1.112xlarge","u-6tb1.56xlarge","u-9tb1.112xlarge","vt1.24xlarge","vt1.3xlarge","vt1.6xlarge","x1.16xlarge","x1.32xlarge","x1e.16xlarge","x1e.2xlarge","x1e.32xlarge","x1e.4xlarge","x1e.8xlarge","x1e.xlarge","x2gd.12xlarge","x2gd.16xlarge","x2gd.2xlarge","x2gd.4xlarge","x2gd.8xlarge","x2gd.large","x2gd.medium","x2gd.xlarge","x2idn.16xlarge","x2idn.24xlarge","x2idn.32xlarge","x2iedn.16xlarge","x2iedn.24xlarge","x2iedn.2xlarge","x2iedn.32xlarge","x2iedn.4xlarge","x2iedn.8xlarge","x2iedn.xlarge","x2iezn.12xlarge","x2iezn.2xlarge","x2iezn.4xlarge","x2iezn.6xlarge","x2iezn.8xlarge","z1d.12xlarge","z1d.2xlarge","z1d.3xlarge","z1d.6xlarge","z1d.large","z1d.xlarge"];

      // const regionCodesForOndemandInstances = ["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-1-tpe-1","ap-northeast-1-wl1-kix1","ap-northeast-1-wl1-nrt1","ap-northeast-2","ap-northeast-2-wl1-cjj1","ap-northeast-2-wl1-sel1","ap-northeast-3","ap-south-1","ap-south-1-ccu-1","ap-south-1-del-1","ap-south-2","ap-southeast-1","ap-southeast-1-bkk-1","ap-southeast-2","ap-southeast-2-per-1","ap-southeast-3","ap-southeast-4","ca-central-1","ca-central-1-wl1-yto1","eu-central-1","eu-central-1-ham-1","eu-central-1-waw-1","eu-central-1-wl1-ber1","eu-central-1-wl1-dtm1","eu-central-1-wl1-muc1","eu-central-2","eu-north-1","eu-north-1-cph-1","eu-north-1-hel-1","eu-south-1","eu-south-2","eu-west-1","eu-west-2","eu-west-2-wl1-lon1","eu-west-2-wl1-man1","eu-west-3","me-central-1","me-south-1","me-south-1-mct-1","sa-east-1","us-east-1","us-east-1-atl-1","us-east-1-bos-1","us-east-1-bue-1","us-east-1-chi-1","us-east-1-dfw-1","us-east-1-iah-1","us-east-1-mci-1","us-east-1-mia-1","us-east-1-msp-1","us-east-1-nyc-1","us-east-1-phl-1","us-east-1-scl-1","us-east-1-wl1","us-east-1-wl1-atl1","us-east-1-wl1-bna1","us-east-1-wl1-chi1","us-east-1-wl1-clt1","us-east-1-wl1-dfw1","us-east-1-wl1-dtw1","us-east-1-wl1-iah1","us-east-1-wl1-mia1","us-east-1-wl1-msp1","us-east-1-wl1-nyc1","us-east-1-wl1-tpa1","us-east-1-wl1-was1","us-east-2","us-gov-east-1","us-gov-west-1","us-west-1","us-west-2","us-west-2-den-1","us-west-2-las-1","us-west-2-lax-1","us-west-2-pdx-1","us-west-2-phx-1","us-west-2-sea-1","us-west-2-wl1","us-west-2-wl1-den1","us-west-2-wl1-las1","us-west-2-wl1-lax1","us-west-2-wl1-phx1","us-west-2-wl1-sea1"];

      // const regionCodesForReservedInstances = ["af-south-1", "ap-east-1", "ap-northeast-1", "ap-northeast-2", "ap-northeast-3", "ap-south-1", "ap-south-2", "ap-southeast-1", "ap-southeast-2", "ap-southeast-3", "ap-southeast-4", "ca-central-1", "eu-central-1", "eu-central-2", "eu-north-1", "eu-south-1", "eu-south-2", "eu-west-1", "eu-west-2", "eu-west-3", "me-central-1", "me-south-1", "sa-east-1", "us-east-1", "us-east-2", "us-gov-east-1", "us-gov-west-1", "us-west-1", "us-west-2"];

      const regions = ["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-south-2","ap-southeast-1","ap-southeast-2","ap-southeast-3","ap-southeast-4","ca-central-1","eu-central-1","eu-central-2","eu-north-1","eu-south-1","eu-south-2","eu-west-1","eu-west-2","eu-west-3","me-central-1","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-west-1","us-west-2"];

      const platforms = ["linux","rhel","windows","suse","linux_web","linux_std","linux_enterprise","windows_web","windows_std","windows_enterprise"];
      
      // const platformsFromCdn = ["linux","linux_enterprise","linux_std","linux_web","rhel","rhel-ha","rhel-ha_enterprise","rhel-ha_std","rhel_enterprise","rhel_std","rhel_web","suse","windows","windows_enterprise","windows_std","windows_web"];

      const offeringClasses = ["standard","convertible"];
      const purchaseTerms = ["1yr", "3yr"];
      const paymentOptions = ["no_upfront", "partial_upfront", "all_upfront"];
      const sqlLicenses = ["std", "web", "enterprise", "no sql license"]

      React.useEffect(() => {
        handleChange();
      }, [purchaseType, instanceType, region, platform, offeringClass, purchaseTerm, paymentOption, sqlLicense]);

      React.useEffect(() => {
        if(!comparisonEnabled) {

        }
      },[comparisonEnabled])

    function handleChange() {
      const displayStringOrNumber = x => typeof x === 'number' ? x : `"${x}"`;
      const args = getArgsForFormula();
      const value = `AWS_${baseFormula}(${args.map(displayStringOrNumber).join(", ")})`;
      console.log(value);
      setFormula(value);
      setArgs(args);
    }

      function getArgsForFormula() {
        let args = [purchaseType, instanceType, region, platform];
        if(purchaseType === 'reserved')
          args = args.concat([offeringClass, purchaseTerm, paymentOption])

        const filteredSqlLicense = sqlLicense.split("/").map(x => x === "no sql license" ? "" : x).join("/")
        if(filteredSqlLicense)
          args = args.concat(filteredSqlLicense);
        return args;
      }

      function prependOptionMinusWhenReservedInstance(arr) {
        return purchaseType !== 'reserved' ? ['-'].concat(arr) : arr;
      }

      return (
        <div>
          <table>
                <tr>
                    <td>Purchase Type</td>
                    <td>
                        <SelectInput options={purchaseTypes} value={purchaseType} onChange={e => setPurchaseType(e.target.value)} />
                    </td>
                </tr>
                <tr>
                    <td>Instance Type</td>
                    <td>
                      <SelectInputWithCheckboxes comparisonEnabled={comparisonEnabled} options={instanceTypes} value={instanceType} setter={setInstanceType}/>
                    </td>
                </tr>
                <tr>
                  <td>Region</td>
                  <td>
                    <SelectInputWithCheckboxes comparisonEnabled={comparisonEnabled} options={regions} value={region} setter={setRegion}/>
                  </td>
                </tr>
                <tr>
                  <td>Platform</td>
                  <td>
                    <SelectInputWithCheckboxes comparisonEnabled={comparisonEnabled} options={platforms} value={platform} setter={setPlatform}/>
                  </td>
                </tr>
                <tr>
                    <td>Offering Class</td>
                    <td>
                      <SelectInputWithCheckboxes comparisonEnabled={comparisonEnabled} options={offeringClasses} value={offeringClass} disabled={purchaseType !== 'reserved'} setter={setOfferingClass} />
                    </td>
                </tr>
                <tr>
                    <td>Purchase Term</td>
                    <td>
                        <SelectInputWithCheckboxes comparisonEnabled={comparisonEnabled} options={purchaseTerms} value={purchaseTerm} disabled={purchaseType !== 'reserved'} setter={setPurchaseTerm} />
                    </td>
                </tr>
                <tr>
                    <td>Payment Option</td>
                    <td>
                        <SelectInputWithCheckboxes comparisonEnabled={comparisonEnabled} options={paymentOptions} value={paymentOption} disabled={purchaseType !== 'reserved'} setter={setPaymentOption} />
                    </td>
                </tr>
                <tr>
                    <td>SQL License</td>
                    <td>
                        <SelectInputWithCheckboxes comparisonEnabled={comparisonEnabled} options={sqlLicenses} value={sqlLicense} disabled={purchaseType !== 'reserved'} setter={setSQLLicense} />
                    </td>
                </tr>
            </table>
        </div>
      );
    }


  function EBS({ setFormula, setArgs, comparisonEnabled}) {
    const [baseFormula, setBaseFormula] = React.useState('EBS');
    const [volumeType, setVolumeType] = React.useState('magnetic');
    const [storageType, setStorageType] = React.useState('storage');
    const [region, setRegion] = React.useState('us-east-1');
    const [volumeSize, setVolumeSize] = React.useState(4000);

    const regionCodes = ["af-south-1","ap-east-1","ap-northeast-1","ap-northeast-2","ap-northeast-3","ap-south-1","ap-south-2","ap-southeast-1","ap-southeast-2","ap-southeast-3","ap-southeast-4","ca-central-1","eu-central-1","eu-central-2","eu-north-1","eu-south-1","eu-south-2","eu-west-1","eu-west-2","eu-west-3","me-central-1","me-south-1","sa-east-1","us-east-1","us-east-2","us-gov-east-1","us-gov-west-1","us-west-1","us-west-2"];

    const volumeTypes = {
      storage: ["magnetic", "gp2", "io1", "io2", "st1", "sc1"],
      iops: ["io1", "io2", "gp3"],
      snapshot: []};
    const storageTypes = ["storage", "iops", "snapshot"];

    React.useEffect(() => {
      handleChange();
    }, [volumeType, storageType, region, volumeSize]);

    function handleChange() {
      const displayStringOrNumber = x => typeof x === 'number' ? x : `"${x}"`;
      const args = getArgsForFormula();
      const value = `AWS_${baseFormula}(${args.map(displayStringOrNumber).join(", ")})`;
      console.log(value);
      setFormula(value);
      setArgs(args);
    }

    function getArgsForFormula() {
      if(!volumeTypes[storageType].includes(volumeType)) {
        setVolumeType(volumeTypes[storageType][0] || "");
      }
      return [volumeType, storageType, volumeSize, region];
    }

    // purchaseType, instanceType, region, platform, offeringClass, (reserved: purchaseTerm, paymentOption, sqlLicense)
    // "reserved", "m5.xlarge", "us-east-2", "linux", "standard",   (reserved: "1yr", "no_upfront", "std")
    return (
      <div>
        <table>
          <tr>
            <td>Volume Type</td>
            <td>
              {volumeTypes[storageType].length > 0 ? (
                <select value={volumeType} onChange={e => setVolumeType(e.target.value)}>
                  {volumeTypes[storageType].map(x => <option value={x}>{x}</option>)}
                </select>
              ) : (<span className="text">-</span>)}
            </td>
          </tr>
          <tr>
            <td>Storage Type</td>
            <td>
              <select value={storageType} onChange={e => setStorageType(e.target.value)}>
                {storageTypes.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>
          <tr>
            <td>Volume Size</td>
            <td>
              <input type="number" value={volumeSize} onChange={e => setVolumeSize(parseInt(e.target.value))} />
            </td>
          </tr>
          <tr>
            <td>Region</td>
            <td>
              <select value={region} onChange={e => setRegion(e.target.value)}>
                {regionCodes.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>
        </table>
      </div>
    );
  }


  function RDS({ setFormula, setArgs, comparisonEnabled }) {
    const [dbEngine, setDbEngine] = React.useState('aurora/mysql');
    const [instanceType, setInstanceType] = React.useState('db.r6g.xlarge');
    const [region, setRegion] = React.useState('us-east-1');
    const [purchaseType, setPurchaseType] = React.useState('reserved');
    const [purchaseTerm, setPurchaseTerm] = React.useState('3yr');
    const [paymentOption, setPaymentOption] = React.useState('partial_upfront');

    const [baseFormula, setBaseFormula] = React.useState('RDS');
    const [paymentOptions, setPaymentOptions] = React.useState(["no_upfront", "partial_upfront", "all_upfront"]);


    const dbEngines = ['aurora/mysql', 'aurora/postgresql', 'mysql', 'postgresql', 'mariadb'];

    const instanceTypes = ["db.m1.large","db.m1.medium","db.m1.small","db.m1.xlarge","db.m2.2xlarge","db.m2.4xlarge","db.m2.xlarge","db.m3.2xlarge","db.m3.large","db.m3.medium","db.m3.xlarge","db.m4.10xlarge","db.m4.16xlarge","db.m4.2xlarge","db.m4.4xlarge","db.m4.large","db.m4.xlarge","db.m5.12xlarge","db.m5.16xlarge","db.m5.24xlarge","db.m5.2xlarge","db.m5.4xlarge","db.m5.8xlarge","db.m5.large","db.m5.xlarge","db.m5d.12xlarge","db.m5d.16xlarge","db.m5d.24xlarge","db.m5d.2xlarge","db.m5d.4xlarge","db.m5d.8xlarge","db.m5d.large","db.m5d.xlarge","db.m6g.12xlarge","db.m6g.16xlarge","db.m6g.2xlarge","db.m6g.4xlarge","db.m6g.8xlarge","db.m6g.large","db.m6g.xlarge","db.m6gd.12xlarge","db.m6gd.16xlarge","db.m6gd.2xlarge","db.m6gd.4xlarge","db.m6gd.8xlarge","db.m6gd.large","db.m6gd.xlarge","db.m6i.12xlarge","db.m6i.16xlarge","db.m6i.24xlarge","db.m6i.2xlarge","db.m6i.32xlarge","db.m6i.4xlarge","db.m6i.8xlarge","db.m6i.large","db.m6i.xlarge","db.r3.2xlarge","db.r3.4xlarge","db.r3.8xlarge","db.r3.large","db.r3.xlarge","db.r4.16xlarge","db.r4.2xlarge","db.r4.4xlarge","db.r4.8xlarge","db.r4.large","db.r4.xlarge","db.r5.12xlarge","db.r5.16xlarge","db.r5.24xlarge","db.r5.2xlarge","db.r5.4xlarge","db.r5.8xlarge","db.r5.large","db.r5.xlarge","db.r5b.12xlarge","db.r5b.16xlarge","db.r5b.24xlarge","db.r5b.2xlarge","db.r5b.4xlarge","db.r5b.8xlarge","db.r5b.large","db.r5b.xlarge","db.r5d.12xlarge","db.r5d.16xlarge","db.r5d.24xlarge","db.r5d.2xlarge","db.r5d.4xlarge","db.r5d.8xlarge","db.r5d.large","db.r5d.xlarge","db.r6g.12xlarge","db.r6g.16xlarge","db.r6g.2xlarge","db.r6g.4xlarge","db.r6g.8xlarge","db.r6g.large","db.r6g.xlarge","db.r6gd.12xlarge","db.r6gd.16xlarge","db.r6gd.2xlarge","db.r6gd.4xlarge","db.r6gd.8xlarge","db.r6gd.large","db.r6gd.xlarge","db.r6i.12xlarge","db.r6i.16xlarge","db.r6i.24xlarge","db.r6i.2xlarge","db.r6i.32xlarge","db.r6i.4xlarge","db.r6i.8xlarge","db.r6i.large","db.r6i.xlarge","db.t1.micro","db.t2.2xlarge","db.t2.large","db.t2.medium","db.t2.micro","db.t2.small","db.t2.xlarge","db.t3.2xlarge","db.t3.large","db.t3.medium","db.t3.micro","db.t3.small","db.t3.xlarge","db.t4g.2xlarge","db.t4g.large","db.t4g.medium","db.t4g.micro","db.t4g.small","db.t4g.xlarge","db.x1.16xlarge","db.x1.32xlarge","db.x1e.16xlarge","db.x1e.2xlarge","db.x1e.32xlarge","db.x1e.4xlarge","db.x1e.8xlarge","db.x1e.xlarge","db.x2g.12xlarge","db.x2g.16xlarge","db.x2g.2xlarge","db.x2g.4xlarge","db.x2g.8xlarge","db.x2g.large","db.x2g.xlarge","db.z1d.12xlarge","db.z1d.2xlarge","db.z1d.3xlarge","db.z1d.6xlarge","db.z1d.large","db.z1d.xlarge"];

    const regionCodes = ['us-east-1', 'us-west-2', 'eu-west-1', 'us-east-2', 'eu-central-1', 'ap-northeast-1', 'ap-southeast-2', 'ap-southeast-1', 'ap-south-1', 'ap-northeast-2', 'us-gov-west-1', 'us-west-1', 'eu-west-2', 'sa-east-1', 'ca-central-1', 'eu-west-3', 'us-gov-east-1', 'eu-south-1', 'eu-north-1', 'ap-northeast-3', 'af-south-1', 'ap-east-1', 'me-south-1', 'ap-southeast-3', 'ap-south-2', 'ap-southeast-4', 'eu-south-2', 'me-central-1', 'eu-central-2'];


    const purchaseTypes = ["ondemand", "reserved"];
    const offeringClasses = ["standard", "convertible"];
    const purchaseTerms = ["1yr", "3yr"];

    React.useEffect(() => {
      handleChange();
      // mention this only in add-on custom-function in sheet cell, not in the formula builder?
      if(purchaseTerm === "3yr") {
        setPaymentOptions(["partial_upfront", "all_upfront"]);
        if(paymentOption === "no_upfront") {
          window.alert(`"No upfront payment" is not available for 3 year term. Changing to partial upfront.`);
          setPaymentOption("partial_upfront");
        }
      } else
        setPaymentOptions(["no_upfront", "partial_upfront", "all_upfront"]);
    }, [dbEngine, instanceType, region, purchaseType, purchaseTerm, paymentOption]);

    function handleChange() {
      const displayStringOrNumber = x => typeof x === 'number' ? x : `"${x}"`;
      const args = getArgsForFormula();
      const value = `AWS_${baseFormula}(${args.map(displayStringOrNumber).join(", ")})`;
      console.log(value);
      setFormula(value);
      setArgs(args);
    }

    function getArgsForFormula() {
      let args = [dbEngine, instanceType, region, purchaseType];
      if (purchaseType === 'reserved')
        args = args.concat([purchaseTerm, paymentOption]);
      return args;
    }

    function prependOptionMinusWhenReservedInstance(arr) {
      return purchaseType !== 'reserved' ? ['-'].concat(arr) : arr;
    }

    return (
      <div>
        <table>
          <tr>
            <td>Database Engine</td>
            <td>
              <select onChange={e => setDbEngine(e.target.value)} value={dbEngine}>
                {dbEngines.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>
          <tr>
            <td>Instance Type</td>
            <td>
              <select onChange={e => setInstanceType(e.target.value)} value={instanceType}>
                {instanceTypes.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>
          <tr>
            <td>Region</td>
            <td>
              <select onChange={e => setRegion(e.target.value)} value={region}>
                {regionCodes.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>
          <tr>
            <td>PurchaseType</td>
            <td>
              <select onChange={e => setPurchaseType(e.target.value)} value={purchaseType}>
                {purchaseTypes.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>

            <tr>
              <td>Purchase Term</td>
              <td>
                <select disabled={purchaseType !== 'reserved'} value={purchaseType !== 'reserved' ? '-' : purchaseTerm} onChange={e => setPurchaseTerm(e.target.value)}>
                  {prependOptionMinusWhenReservedInstance(purchaseTerms).map(x => <option value={x}>{x}</option>)}
                </select>
              </td>
            </tr>
            <tr>
              <td>Payment Option</td>
              <td>
                <select disabled={purchaseType !== 'reserved'} value={purchaseType !== 'reserved' ? '-' : paymentOption} onChange={e => setPaymentOption(e.target.value)}>
                  {prependOptionMinusWhenReservedInstance(paymentOptions).map(x => <option value={x}>{x}</option>)}
                </select>
              </td>
            </tr>
        </table>
      </div>
    );
  }


  function RDSStorage({ setFormula, setArgs, comparisonEnabled }) {
    const [baseFormula, setBaseFormula] = React.useState('RDS_STORAGE');
    const [storageType, setStorageType] = React.useState('gp2');
    const [storageSize, setStorageSize] = React.useState(4000);
    const [region, setRegion] = React.useState('us-east-1');

    const regionCodes = ['us-east-1', 'us-west-2', 'eu-west-1', 'us-east-2', 'eu-central-1', 'ap-northeast-1', 'ap-southeast-2', 'ap-southeast-1', 'ap-south-1', 'ap-northeast-2', 'us-gov-west-1', 'us-west-1', 'eu-west-2', 'sa-east-1', 'ca-central-1', 'eu-west-3', 'us-gov-east-1', 'eu-south-1', 'eu-north-1', 'ap-northeast-3', 'af-south-1', 'ap-east-1', 'me-south-1', 'ap-southeast-3', 'ap-south-2', 'ap-southeast-4', 'eu-south-2', 'me-central-1', 'eu-central-2'];

    const storageTypes = ["aurora", "gp2", "magnetic", "piops"];

    React.useEffect(() => {
      handleChange();
    }, [storageType, region, storageSize]);

    function handleChange() {
      const displayStringOrNumber = x => typeof x === 'number' ? x : `"${x}"`;
      const args = getArgsForFormula();
      const value = `AWS_${baseFormula}(${args.map(displayStringOrNumber).join(", ")})`;
      console.log(value);
      setFormula(value);
      setArgs(args);
    }

    function getArgsForFormula() {
      return [storageType, storageSize, region];
    }

    return (
      <div>
        <table>
          <tr>
            <td>Storage Type</td>
            <td>
              <select value={storageType} onChange={e => setStorageType(e.target.value)}>
                {storageTypes.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>
          <tr>
            <td>Storage Size</td>
            <td>
              <input type="number" value={storageSize} onChange={e => setStorageSize(parseInt(e.target.value))} />
            </td>
          </tr>
          <tr>
            <td>Region</td>
            <td>
              <select value={region} onChange={e => setRegion(e.target.value)}>
                {regionCodes.map(x => <option value={x}>{x}</option>)}
              </select>
            </td>
          </tr>
        </table>
      </div>
    );
  }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>  
</body>
</html>
