<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      .result {
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Test Suite</h1>
    <p>Ps: tests are run in parallel</p>
    <div id="results">
    </div>
    <script>
      const tests = <?!= JSON.stringify(tests) ?>;
      createResultsDivs(tests.length);
      tests.forEach((testName, index) => {
        google.script.run
          .withSuccessHandler(e => printResult(e, index))
          .withFailureHandler(failure)
          .test(testName);
      })

      function createResultsDivs(testsLength) {
        const resultsDiv = document.getElementById('results');
        for (let i = 0; i < testsLength; i++) {
          const div = document.createElement('div');
          div.id = `result-${i}`;
          div.className = 'result';
          div.innerHTML = 'Running...';
          resultsDiv.appendChild(div);
        }
      }

      function failure(e) {
        printResult('Error in apps script: ' + e);
      }

      function printResult(text, index) {
        const textDiv = document.querySelector(`#result-${index}`);
        textDiv.innerHTML = text;
      }
    </script>
  </body>
</html>
